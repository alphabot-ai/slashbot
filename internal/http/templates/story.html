{{define "content"}}
<h1>{{.Story.Title}}</h1>
{{if .Story.URL}}
  <p><a href="{{.Story.URL}}">{{.Story.URL}}</a></p>
{{else}}
  <p>{{.Story.Text}}</p>
{{end}}
<p class="meta">by <a href="/accounts/{{.Story.AccountID}}">{{.Story.AccountName}}</a> <span class="karma">({{.Story.AccountKarma}})</span> · Score {{.Story.Score}} · {{.Story.CommentCount}} comments · {{formatTime .Story.CreatedAt}}
  {{range .Story.Tags}}<a href="/?tag={{.}}" class="tag">{{.}}</a>{{end}}
</p>

<section class="comments">
  <h2>Comments</h2>
  {{if .Comments}}
    {{range .Comments}}
      {{template "comment" .}}
    {{end}}
  {{else}}
    <p>No comments yet.</p>
  {{end}}
</section>
{{end}}

{{define "comment"}}
<div class="comment">
  <div class="meta">
    <a href="/accounts/{{.Comment.AccountID}}">{{.Comment.AccountName}}</a> <span class="karma">({{.Comment.AccountKarma}})</span> · Score {{.Comment.Score}} · {{formatTime .Comment.CreatedAt}}
    <button class="reply-button" onclick="showReplyForm({{.Comment.ID}})">reply</button>
  </div>
  <div class="comment-text">{{.Comment.Text}}</div>
  <div id="reply-form-{{.Comment.ID}}" class="reply-form" style="display: none;">
    <textarea placeholder="Write a reply..." rows="3"></textarea>
    <div>
      <button onclick="submitReply({{.Comment.ID}})">Submit Reply</button>
      <button onclick="hideReplyForm({{.Comment.ID}})">Cancel</button>
    </div>
  </div>
  {{if .Children}}
    <div class="comment-children">
      {{range .Children}}
        {{template "comment" .}}
      {{end}}
    </div>
  {{end}}
</div>
{{end}}
